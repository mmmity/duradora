# duradora
An API for music streaming service

МФТИ, Практикум Python 2024, 1 курс, Б05-328, Канухин Александр

## Описание
Сервер для музыкального стримингового сервиса, написанный на Python. Хранит аудиофайлы и их метаданные, поддерживает регистрацию пользователей, загрузку аудиофайлов с метаданными от админов, стриминг аудиофайлов по id, составление плейлистов от пользователей. Всё через REST API.

## Варианты использования
### Базовый функционал
Загрузка аудиофайла и стриминг аудиофайла с клиента. Добавление метаданных, хранение данных о треках в базе данных. Регистрация и авторизация пользователей, ограничение доступа к некоторому функционалу для неавторизованных и неадминов.

### Дополнительный функционал
Поиск по имеющимся трекам, составление плейлистов для пользователей. Модификаторы доступа к плейлистам: публичные/приватные/по ссылке. Простенький клиент для тестирования.

## Стек
- Python 3.12
- fastapi
- sqlite

## Зависимости
[fastapi](https://github.com/tiangolo/fastapi) - фреймворк для создания асинхронных REST API
[sqlite3](https://docs.python.org/3/library/sqlite3.html) - для базы данных

## Эндпоинты
### Треки
- POST `/track` - добавляет новый трек, параметры - файл и метаданные. Все параметры опциональные и их можно загрузить позднее. Возвращает либо идентификатор нового трека, либо описание ошибки, если такая возникла
- POST `/track?id=` - обновляет метаданные и файл уже существующего трека. Те же параметры. Возвращает то же самое, что и выше.
- GET `/track?id=` - возвращает метаданные трека либо описание ошибки
- GET `/stream?id=` - устанавливает соединение для стриминга трека
### Пользователи
- POST `/register` - добавляет нового пользователя, параметры - логин, пароль. Возвращает success либо описание ошибки
- POST `/login` - пытается авторизоваться, параметры - логин, пароль. Возвращает токен либо описание ошибки
- POST `/set_rights` - меняет права пользователя, доступна только админу. Принимает юзернейм и новые права. Возвращает success либо описание ошибки
### Плейлисты
- POST `/playlist` - создает новый плейлист для авторизованного пользователя. Принимает название и параметры. Возвращает идентификатор плейлиста или описание ошибки 
- POST `/playlist/add_song?id=` - добавляет песню id в плейлист. Возвращает либо success, либо описание ошибки
- POST `/playlist/remove_song?id=` - удаляет песню id из плейлиста. Возвращает либо success, либо описание ошибки
- GET `/playlist?id=` - выдает список треков в плейлисте, если он публичный. Возвращает список треков либо описание ошибки
- GET `/user/playlists?username=` - выдает список публичных плейлистов у пользователя username, либо описание ошибки
- GET `/playlist/search?search_string=` - пытается провести поиск по плейлисту и возвращает результаты


## Архитектура
Основной функционал реализуется через методы FastAPI, к нему не нужна дополнительная обертка. Нужны:

### Классы баз данных
UserController, TrackController, PlaylistController - классы, которые содержат методы для работы с соответствующими таблицами SQL (примеры - `UserController.add_user(...)`, `PlaylistController.search(...)`)
Также датаклассы User, Track, Playlist, содержащие параметры соответствующих объектов.

### TrackStream
Класс, содержащий файл трека и метод `iter()`, который делает `yield` новой порции данных для того, чтобы возвращать созданный из него `fastapi.responses.StreamingResponse`

### Config
Класс, который умеет парсить конфигурационные файлы (toml, например), и содержит все нужные константы.
